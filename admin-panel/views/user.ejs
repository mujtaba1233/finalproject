<%- include header.ejs %>
<div ng-controller="UserController">
    <div class="row">
        <div class="col-md-6">
            <h2>User Management</h2>
        </div>
    </div>
    <div class="row">
        <form id="userform" class="w-100" ng-submit="saveUser()">
            <div class="col-lg-12">
                <div class="row">

                    <div class="col-md-3 form-group">
                        <label>First Name</label>
                        <input  type="text" ng-model="user.firstname" class="custom-input form-control">
                    </div>
                    <div class="col-md-3 form-group">
                        <label>Last Name</label>

                        <input  type="text" ng-model="user.lastname" class="custom-input form-control">
                    </div>
                    <div class="col-md-3 form-group">
                        <label>Email</label>
                        <input ng-disabled="update"  type="email" ng-model="user.email"
                            class="custom-input form-control">
                    </div>
                    <div class="col-md-3 form-group">
                        <label>User Role</label>
                        <select class="custom-input form-control" ng-model="user.usertype">
                            <option value="user"> User</option>
                            <option value="admin"> Admin</option>
                            <option value="external"> External</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="col-md-3 form-group">
                <input type="checkbox" ng-model="user.active"> Active
            </div>

    </div>
    <div class="row">
        <div class="col-md-12 form-group">
            <button type="submit" title="{{update? 'Update User': 'Save User'}}"
                class="btn {{update? 'btn-primary': 'btn-success'}} pull-right btn-lg">{{update? 'Update': 'Save'}}</button>

            <button style="margin-right: 5px;" ng-if="update" title="Cancel" ng-click="cancelUpdate()"
                class="btn btn-warning pull-right btn-lg">Cancel</button>
        </div>
    </div>
    </form>
    <table st-table="allUsers" st-safe-src="users" class="table table-striped table-hover table-user table-scroll" id="table-scroll">
        <thead>
            <tr>
                <button type="button" class="btn btn-outline-success mb-2 pull-right"
			ng-click="updateExportFileName(true)" ng-csv="users"
			csv-header="selectedOptions" csv-column-order="selectedOptions"
			filename="user.csv"><i class="fa fa-file"></i> Export {{users.length}} Users </button>
            </tr>
            <tr>
                <th style="width: 5%" st-sort="id">Id</th>
                <th style="width: 15%" st-sort="lastname">Name</th>
                <th style="width: 20%; text-align:center;" st-sort="email">Email</th>
                <th style="width: 15%; text-align:center;" st-sort="usertype">Role</th>
                <th style="width: 15%; text-align:center;" st-sort="usertype">Active</th>
                <th style="width: 15%; text-align:center;" st-sort="usertype">Email Confirmed</th>
                <th style="width: 15%; text-align:right;">Action</th>
            </tr>
            <tr>

                <th colspan="8">
                    <input st-search="" class="custom-input form-control" placeholder="global search ..." type="text" />
                </th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="user in allUsers">
                <td>{{user.id}}</td>
                <td class="text-capitalize">{{user.lastname}}, {{user.firstname}}</td>
                <td class="text-center">{{user.email}}</td>
                <td class="text-center">{{user.usertype == 'admin'? "Administrator" :user.usertype == 'user'? "User":user.usertype == 'external'?'External':'N/A'}}</td>
                <td class="text-center {{user.active == 1? 'text-success' : 'text-danger'}}">
                    {{user.active == 1? "Active" : "In-Active"}}</td>
                <td class="text-center {{user.token == 'verifiedUser'? 'text-success' : 'text-danger'}}">
                    {{user.token == 'verifiedUser'? "Confirmed" : "Pending"}}</td>
                <td class="text-right">
                    <a title="Resend Account Confirmation Mail" href="javascript:void(0)" ng-if="user.token != 'verifiedUser'" ng-click="SendMail(user)"
                    class="btn btn-sm btn-default">
                    <i class="fa fa-paper-plane">
                    </i>
                </a>
                    <a title="Edit User" href="javascript:void(0)" ng-click="updateUser(user)"
                        class="btn btn-sm btn-primary">
                        <i class="fa fa-pencil fa-2x">
                        </i>
                    </a>
                </td>
            </tr>
        </tbody>
        <tfoot class="text-center d-flex justify-content-center tfoot-toggle">
            <tr>
                <td colspan="12" >
                    <div class="paging">
                        <div st-pagination=""  st-template="template/st-pagination.html" st-items-by-page="itemsByPage" st-displayed-pages="7"></div>
                    </div>
                </td>
            </tr>
        </tfoot>
    </table>
    <!-- Modal -->

</div>


<%- include footer.ejs %>